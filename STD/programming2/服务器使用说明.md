# 视听信息系统导论服务器使用说明

## 重要说明

- 服务器仅用于完成编程作业，禁止用于其他用途。如果违反规定，账号可能会被禁止使用，甚至影响作业成绩。
- 服务器资源总体充足，但在特定时间集中使用可能导致拥挤或冲突。请安排好完成时间，**作业不会因为服务器拥挤延期**。
- 我们会尽可能维护服务器的正常运行，但确保重要文件的安全是你的责任，请做好备份。


## 登录

### 用户名和密码

每个小组共用一个服务器账号。账号的用户名和密码将分组提供。

### 服务器地址

- IP: 101.6.64.95 / 101.6.64.96
- Port: 22

Window、Mac和Linux系统都可以使用`ssh`连接服务器：`ssh -p 22 $username@$host_ip`（将`$username`替换为下发的服务器用户名，`$host_ip`为分配到的节点IP）。随后将会弹出键入密码的提示，输入密码后即可登录服务器。

注意：为了保障服务器安全，服务器**仅限清华校园网IP登录**。如需校外登录，请参考学校info配置校外访问VPN。

## 文件和数据

你的所有文件只能储存在账号的对应目录下：`~`即`/data2/$username`。请不要在其他目录下储存文件。

为了确保文件路径能正确解析，**建议均使用绝对路径**。

我们在公共目录`/data2/hw_data`下提供了作业所需的相关数据和文件。**请不要将数据和模型复制到账号的目录下**，代码中加载路径已默认设定为公共目录对应的绝对路径。

每个账号对应目录下的文件储存容量限制为**2GB**，可以使用`du -h -d 1 ~`命令查看当前储存的使用情况。

**所有储存在服务器上的文件均有可能丢失**。我们建议在本地编辑代码后在服务器上运行，并及时下载重要的文件。

## GPU资源

每个服务器节点共有8张4090显卡，每张显卡的显存为24G。为了保证所有小组都有足够的GPU资源，我们将每张显卡分配给6个账号共用，**每个账号只能使用分配到的GPU**。分配表如下：

### 101.6.64.95节点分配表

| IP | GPU id | Username |
| -- | -- | -- |
| 101.6.64.95 | 0 | ai_hw_1, ai_hw_2, ai_hw_3, ai_hw_4, ai_hw_5, ai_hw_6 |
| 101.6.64.95 | 1 | ai_hw_7, ai_hw_8, ai_hw_9, ai_hw_10, ai_hw_11, ai_hw_12 |
| 101.6.64.95 | 2 | ai_hw_13, ai_hw_14, ai_hw_15, ai_hw_16, ai_hw_17, ai_hw_18 |
| 101.6.64.95 | 3 | ai_hw_19, ai_hw_20, ai_hw_21, ai_hw_22, ai_hw_23, ai_hw_24 |
| 101.6.64.95 | 4 | ai_hw_25, ai_hw_26, ai_hw_27, ai_hw_28, ai_hw_29, ai_hw_30 |
| 101.6.64.95 | 5 | ai_hw_31, ai_hw_32, ai_hw_33, ai_hw_34, ai_hw_35, ai_hw_36 |
| 101.6.64.95 | 6 | ai_hw_37, ai_hw_38, ai_hw_39, ai_hw_40, ai_hw_41, ai_hw_42 |
| 101.6.64.95 | 7 | ai_hw_43, ai_hw_44, ai_hw_45, ai_hw_46, ai_hw_47, ai_hw_48 |

### 101.6.64.96节点分配表

| IP | GPU id | Username |
| -- | -- | -- |
| 101.6.64.96 | 0 | ai_hw_49, ai_hw_50, ai_hw_51, ai_hw_52, ai_hw_53, ai_hw_54 |
| 101.6.64.96 | 1 | ai_hw_55, ai_hw_56, ai_hw_57, ai_hw_58, ai_hw_59, ai_hw_60 |
| 101.6.64.96 | 2 | ai_hw_61, ai_hw_62, ai_hw_63, ai_hw_64, ai_hw_65, ai_hw_66 |
| 101.6.64.96 | 3 | ai_hw_67, ai_hw_68, ai_hw_69, ai_hw_70, ai_hw_71, ai_hw_72 |
| 101.6.64.96 | 4 | ai_hw_73, ai_hw_74, ai_hw_75, ai_hw_76, ai_hw_77, ai_hw_78 |
| 101.6.64.96 | 5 | ai_hw_79, ai_hw_80, ai_hw_81, ai_hw_82, ai_hw_83, ai_hw_84 |
| 101.6.64.96 | 6 | ai_hw_85, ai_hw_86, ai_hw_87, ai_hw_88, ai_hw_89, ai_hw_90 |
| 101.6.64.96 | 7 | ai_hw_91, ai_hw_92, ai_hw_93, ai_hw_94, ai_hw_95, ai_hw_96 |

**请在运行程序时指定对应的GPU**。可以通过指定环境变量`CUDA_VISIBLE_DEVICES`来指定所使用的显卡：`CUDA_VISIBLE_DEVICES=$id <your_command>`，其中`$id`是上表中分配到的GPU id，`<your_command>`是你想要执行的命令。例如，如果想要使用id为1的GPU执行`bash run.sh`命令，请使用`CUDA_VISIBLE_DEVICES=1 bash run.sh`。

你可以使用`nvidia-smi`命令查看当前GPU的使用情况。

**未经许可，不得使用分配以外的GPU**。如果未按规定使用，或恶意抢占GPU资源，将会被警告、终止程序、甚至扣除作业分数。

## Conda环境

我们已经为本次作业配置好了conda环境。要激活环境，请使用命令`conda activate homework`。你可以使用`which python`命令来检查环境是否正确激活，如果返回的结果为`/usr/local/lib/miniconda3/envs/homework/bin/python`，说明环境已经激活。

如果第一次激活环境时出现错误，请首先执行以下命令：`conda init`。

我们提供的环境`homework`为公用环境且不能修改，如果你确实需要修改环境如安装其他包，请新建conda环境。
